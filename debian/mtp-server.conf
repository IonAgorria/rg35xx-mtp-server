description "MTP protocol server"

start on :sys:android-usb-connected or android-usb-connected or :sys:android-mtp-on or android-mtp-on or started lightdm
stop on :sys:android-usb-disconnected or android-usb-disconnected or :sys:android-mtp-off or android-mtp-off or desktop-end

pre-start script

    test -e /sys/devices/virtual/android_usb/android0/state || { stop; exit 0; }
    grep -q DISCONNECTED /sys/devices/virtual/android_usb/android0/state && { stop; exit 0; }
    grep -q mtp /sys/devices/virtual/android_usb/android0/functions || { stop; exit 0; }

end script

env GOOGLE_LOGTOSTDERR=1

respawn
respawn limit unlimited

exec /usr/bin/mtp-server

